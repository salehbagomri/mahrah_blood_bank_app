-- ============================================
-- تنظيف المستخدمين اليتامى
-- ============================================

-- ⚠️ تحذير: هذا السكريبت يحذف المستخدمين الذين:
--    - موجودون في auth.users
--    - لكن غير موجودين في admins أو hospitals
-- ⚠️ لا تنفذه إلا إذا كنت متأكداً!

-- ============================================
-- الخطوة 1: عرض المستخدمين اليتامى أولاً
-- ============================================

SELECT 
    u.id,
    u.email,
    u.created_at,
    'سيتم حذفه ❌' as "الحالة"
FROM auth.users u
WHERE NOT EXISTS (SELECT 1 FROM public.admins WHERE id = u.id)
  AND NOT EXISTS (SELECT 1 FROM public.hospitals WHERE id = u.id)
ORDER BY u.created_at DESC;

-- ============================================
-- الخطوة 2: حذف المستخدمين اليتامى (اختياري)
-- ============================================

-- ⚠️ تحذير: أزل التعليق من السطر التالي فقط إذا كنت متأكداً!
-- DELETE FROM auth.users
-- WHERE id IN (
--     SELECT u.id
--     FROM auth.users u
--     WHERE NOT EXISTS (SELECT 1 FROM public.admins WHERE id = u.id)
--       AND NOT EXISTS (SELECT 1 FROM public.hospitals WHERE id = u.id)
-- );

-- ============================================
-- الخطوة 3: حذف مستخدم واحد محدد (أكثر أماناً)
-- ============================================

-- استخدم هذا بدلاً من الحذف الجماعي:
-- 1. شغّل simple_users_check.sql أولاً
-- 2. انسخ ID المستخدم الذي تريد حذفه
-- 3. استبدل 'USER_ID_HERE' بالـ ID الفعلي
-- 4. أزل التعليق من السطر التالي:

-- DELETE FROM auth.users WHERE id = 'USER_ID_HERE';

-- مثال:
-- DELETE FROM auth.users WHERE id = '123e4567-e89b-12d3-a456-426614174000';

-- ============================================
-- ملاحظات:
-- ============================================

-- ✅ طريقة آمنة للتنظيف:
--    1. شغّل simple_users_check.sql
--    2. تحقق من المستخدمين اليتامى
--    3. احذف واحداً واحداً باستخدام DELETE FROM auth.users WHERE id = 'xxx'

-- ⚠️ لا تحذف:
--    - حسابات الأدمن النشطة
--    - حسابات المستشفيات النشطة
--    - المستخدمين الذين لديهم بيانات مهمة

-- ============================================

